(()=>{"use strict";window.base=((e={})=>{const t="1.0.4",o=window,n=document,r=void 0,s=()=>{},i=n.documentElement||n.body,a=!0,c=!1,l=e=>typeof e,d=e=>Object.prototype.toString.call(e),h=l(s),g=d([]),u=l(""),f=Array.isArray?e=>Array.isArray(e):e=>d(e)===g,p=e=>{throw e},m=e=>p(`Cannot find: ${e}`),y=(e,t)=>p(`Invalid argument ${e}`+(t?`. Expecting (${t})`:"")),_=(e,t)=>{try{const o=JSON.parse(e,t);if(o&&"object"==typeof o)return o}catch(e){}},v=(e,t,o)=>{try{return JSON.stringify(e,t,o)}catch(e){}},b=Math.random,w=setTimeout,k=clearTimeout,C=(e,t=100)=>{let o;const n=t=>{e.apply(r,t)};return(...e)=>(k(o),o=w(n,t,e))},N=(e,t)=>{for(const o in e)if(t(e[o],o))break},x=(e,t)=>{const o=e.indexOf(t);o>=0&&(delete e[o],x(e,t))},S=e=>n.getElementById(e||""),E=e=>e.parentNode,$=(e,t=i)=>t.getElementsByTagName(e||""),I=e=>(e.hidden=c,e),J=e=>(e.hidden=a,e),T=(e,t)=>e.firstChild?e.insertBefore(t,e.firstChild):M(e,t),A=(e,t)=>{if(t)return l(t)===u?e.appendChild(n.createTextNode(t)):e.appendChild(t)},M=(e,t)=>{if(f(t))for(let o=0;o<t.length;o++)A(e,t[o]);else A(e,t)},F=()=>p("Cannot refer root element"),B=e=>(E(e)||p("Cannot remove node with no parent")).removeChild(e),O=(e,t,o)=>{const r=n.createElement(e);if(t)for(const e in t)r.setAttribute(e,t[e]);return o&&M(r,o),r},H=o.getComputedStyle?e=>o.getComputedStyle(e):e=>e.currentStyle,L=e=>new RegExp("(^|\\s+)("+e+")\\s*(?=(\\s|$))","g"),R=new RegExp("[\\.\\|\\s]+","g"),z=(e,t,o)=>{const n=(e,t="|")=>e.replace(R,t).trim(),r=o?n(o," "):"",s=n(r+"|"+t);return e.className=(e.className.replace(L(s),"")+(r.length?" "+r:"")).trim(),e},P=(e,t)=>z(e,r,t),j=(e,t)=>z(e,t),D=(e,t=300)=>(w(j,t,z(e,"_fadeout","__fadein"),"__fadein"),e),K=e=>z(e,"_fadeout","_fadein"),W=e=>z(e,"_fadein|__fadein","_fadeout"),q=(e,t,o)=>{I(P(e,"_peek"));const n=t();return o||J(e),j(e,"_peek"),n},G=e=>"addEventListener"in e&&"removeEventListener"in e,U=e=>"attachEvent"in e&&"detachEvent"in e,X=(e,t,o,n)=>{if(G(e))return e.addEventListener(t,o,n),{h:o,stop:()=>Q(e,t,o,n)};if(U(e)){const r=s=>{o.apply(e,s),n&&n.once&&e.detachEvent("on"+t,r)};return e.attachEvent("on"+t,r),{h:r,stop:()=>e.detachEvent("on"+t,r)}}p("Fail to add event listener.")},Q=(e,t,o,n)=>{G(e)?e.removeEventListener(t,o,n):U(e)?e.detachEvent("on"+t,o):p("Fail to remove event listener.")},V=(e,t)=>o=>{t&&o.isComposing||e(o)},Y=(()=>{const e=[];return{push:t=>{l(t)===h&&e.push(t)},cancel:t=>{x(e,t)},esc:()=>{if(e.length){const t=e.pop();t&&l(t)===h&&t()}else se(n.body)}}})(),Z=e=>{if(e){const t=[],n=e=>{x(t,e)},r=e=>{l(e)===h&&t.push(e)},s=()=>{for(let e=0;e<t.length;e++)t[e]&&l(t[e])===h&&t[e]()},i=t=>e.getItem(t)||"",a=(t,o)=>{e.setItem(t,o),s()},c=t=>{e.removeItem(t),s()},d=t=>parseInt(""+(e.getItem(t)||0)),g=(e,t)=>a(e,""+t),u=(t,o="{}")=>_(e.getItem(t)||o)||_(o)||{},f=(e,t,o="{}")=>a(e,v(t)||o),p=t=>{const o=e.getItem(t),n=_(o),r=o&&!n;if(r){const e=`Base found corrupted data on [${t}].`;console.log("%c"+e,"color:tomato"),w((()=>{if(confirm(`${e} Recover bad data?`)){const e=`${t}.${y()}.x`,n=`Data has been recovered as [${e}].`;ee.setString(e,o),w((()=>{console.log("%c"+n,"color:orange"),alert(n)}))}}))}return!r},m=()=>{let t=0;for(let o=0;o<e.length;o++){const n=e.key(o);n&&(t+=i(n).length)}return t},y=(t="",o=0)=>{const n=t+parseInt(Date.now()+o+"").toString(36);return null!==e.getItem(n)?y(t,o+1):n};return X(o,"storage",s),{storage:e,getString:i,setString:a,getNumber:d,setNumber:g,getJson:u,setJson:f,validateJson:p,onChange:r,cleanOnChange:n,remove:c,size:m,newKey:y}}},ee=Z(o.localStorage),te=Z(o.sessionStorage),oe=(e,t)=>{const o=t?(t.validateJson(e),t.getJson(e)):{},n=(n,r,s=true)=>(o[n]=r,t&&s?(t.setJson(e,o),a):c);return t.onChange((()=>{t.validateJson(e)||t.setJson(e,o)})),{get:e=>o[e],set:n,remove:e=>{n(e,r)}}},ne=oe("base",ee),re=((e=o.navigator.serviceWorker)=>{if(e){const t="Cannot find active service worker.",o=e=>new Promise(((o,n)=>{i(e).then((e=>{if(!e||!e.active)throw t;e.active.postMessage("updateFiles"),o(r)})).catch(n)})),n=e=>new Promise(((o,n)=>{i(e).then((e=>{if(!e||!e.active)throw t;e.active.postMessage("removeFiles"),o(r)})).catch(n)})),s=e=>new Promise(((o,n)=>{i(e).then((e=>{if(!e||!e.active)throw t;e.active.postMessage("removeFiles"),e.unregister().then((t=>{o(t?r:e)})).catch(n)})).catch(n)})),i=t=>e.getRegistration(t);return{get:i,register:t=>e.register(t),unregister:s,removeFiles:n,updateFiles:o}}})(),se=(()=>{const e=O("a",{tabindex:"0",class:"_no-focus"}),t=t=>{T(t,e),e.focus()};return t.clear=()=>{E(e)&&B(e)},t})(),ie=(()=>{const e="_color-scheme",t="theme";let s="",a=["_dark"],c=S(e);c||(c=O("meta",{name:"color-scheme",content:"",id:e}),n.head.appendChild(c));const d=c,h=o.matchMedia,g=e=>{if(!f(e))return y("to change theme");a=e},p=(e="")=>{z(i,s,e);let o="normal";return"dark"===e.slice(1,5)&&(o="dark"),d.setAttribute("content",o),ne.set(t,e),s=e};if(h){const e=h("(prefers-color-scheme: dark)");ne.get(t)!==r?p(ne.get(t)):e.matches?p("_dark"):p(),X(e,"change",(e=>{e.matches?p("_dark"):p()}))}else p(ne.get(t));return{list:g,set:p,change:(e=a)=>l(e)===u?p(e):f(e)?(g(e),p(e[e.indexOf(s)+1]||"")):y("to change theme"),current:()=>s}})(),ae=(t,o)=>{e[o]=t};return X(o,"load",(()=>{const t=S("_script"),i=S("_noscript"),d=(()=>{const e="_scrub";let t,o=c,r=S(e);r||(r=O("div",{id:e,class:"_scrub"}),T(n.body,r));const s=r;return{show:()=>{o||(o=a,k(t),t=w(K,0,I(s)))},hide:()=>{o&&(o=c,k(t),t=w(J,300,W(s)))}}})(),g=(()=>{const e="_error",t=S(e),r=S(e+"-action"),s=S(e+"-description");if(t){const e=e=>{d||(d=a,s&&(s.innerHTML=e?e.message?e.message.replace(/^Uncaught/,""):e:"Unexpected error occured somewhere."),k(l),I(D(t)),Y.push(i),r&&se(r))},i=()=>{d&&(d=c,k(l),l=w(J,300,W(t)),Y.cancel(i),se(n.body))};let l,d=c;return X(o,"error",e),{open:e,close:i}}{const t=()=>m(e);return{open:t,close:t}}})(),u=(()=>{const e=S("_bg");if(e){const t=()=>{l||K(e),l=a},o=()=>{l&&W(e),l=c},n="_bgi _smoothest",s=(e=n,t=1e3)=>{if(d){const o=d;return d=r,w(W,100,P(o,e)),w(B,100+t,o),o}},i=(t,o=n,r=1e3)=>{if(t===d)return;const s=d;d=t,D(P(t,o),r),e.appendChild(t),w((()=>{s&&s!==d&&B(s)}),r)};let l=e.hidden?c:a,d=e.firstElementChild||r;return{show:t,hide:o,now:()=>d,set:i,remove:s}}{const e=()=>m("_bg");return{show:e,hide:e,now:s,set:e,remove:s}}})(),f=(()=>{const e="_overlay",t=S(e),o=S("_close-overlay");if(t){const e=(e={})=>{if(!l){l=a,k(i),e.esc&&Y.push(n),o&&(e.close===a?(e.esc?o.title="Close (esc)":o.title="Close",I(o)):J(o));let r="_fadein";e.blur&&(r="_fadein _blur"),i=w(z,0,I(t),"_fadeout",r)}},n=()=>{l&&(l=c,k(i),i=w(J,300,z(t,"_fadein|_blur","_fadeout")),Y.cancel(n))},r=e=>{t&&X(t,"click",e)},s=e=>{t&&Q(t,"click",e)};o&&X(o,"click",n);let i,l=c;return{show:e,hide:n,click:r,ignore:s}}{const t=()=>m(e);return{show:t,hide:t,click:t,ignore:t}}})(),y=(e={id:[]})=>{const t=e.id[0],n=S(t)||m(t),r=S(e.id[1]);n.style.touchAction="none";const s=q(n,(()=>({x:0-n.offsetWidth/2,y:0-n.offsetHeight/2}))),i={x:s.x,y:s.y},d=e.stay,g=e=>{n.style.transform=`translate(${e.x}px,${e.y}px)`},u=()=>{v&&(k(_),k(y),Y.cancel(u),f.ignore(u),f.hide(),((e,t=300,o="_smooth")=>{const n=e.style;n.height=`${e.offsetHeight}px`,n.marginBottom=`-${H(e).marginBottom}`,P(e,o),w((()=>{n.height=".1px",w((()=>{n.height=n.marginBottom="",J(j(e,o))}),t)}))})(P(n,"_fadeout")),y=w((()=>{v=c,l(e.onClose)===h&&e.onClose(n)}),300))},p=C((()=>{q(n,(()=>{n.style.transform="",s.x=i.x=0-n.offsetWidth/2,s.y=i.y=0-n.offsetHeight/2}),v)}));let y,_,v=c;return X(o,"resize",p),r&&X(r,"click",u),e.interact&&e.interact(n,s,g),{open:(t={})=>{v||(k(_),k(y),t.esc&&Y.push(u),!e.interact||t.stay||d||(s.x=i.x,s.y=i.y,g(s)),r&&(t.close===c||e.close===c?J(r):(r.title="Close",t.esc&&(r.title="Close (esc)"),I(r))),t.overlay&&(f.show({close:c,blur:t.blur}),t.esc&&f.click(u)),y=w((()=>{I(z(n,"_fadeout|_lift-1","__zoomin-c")),w(z,300,n,"__zoomin-c","_lift-1"),v=a;const o=t.timeout||e.timeout;o&&(_=w(u,o))}),t.overlay?300:0))},close:u,destroy:e=>{r&&Q(r,"click",u),Q(o,"resize",p),u(),e&&l(e)===h&&w((()=>{e(n),B(n)}),300)}}},_=(()=>{const e=S("_app");if(e)return{show:()=>I(e)}})();t&&B(t),i&&!e.keep_noscript&&B(i),e.ignore_keyboard||X(o,"keyup",V((e=>{"Escape"===e.code?Y.esc():e.altKey&&"KeyT"===e.code?ie.change():"Tab"===e.code&&se.clear()}))),_&&!e.hide_app&&_.show(),d.hide(),N({app:_,scrub:d,error:g,details:(e,t)=>{const o=$("summary",e)[0],n=$("section",e)[0];if(!(e&&o&&n))throw"Malformed details: "+t;let r,s;const i=e.style,l=o.style,d=()=>{e.open?i.height=s+"px":i.height=r+"px"};X(o,"click",(()=>{if(isNaN(r)||isNaN(s)){i.opacity="0",i.height="";const t=e.open;e.open=c,r=e.offsetHeight,e.open=a,s=e.offsetHeight,e.open=t,d(),i.opacity=""}w((()=>{i.overflow="hidden",l.outline="0",d(),w((()=>{i.overflow="",l.outline=""}),300)}))}))},bg:u,overlay:f,modal:y,toast:(e={id:[]})=>{const t="_toaster",o=S(t)||m(t),n=e.id[0],s=e.id[1],i=S(n)||m(n);S(s)||m(s),J(i);let c=0;const l=[];return{pop:(t={})=>{const d=n+"-"+c++,h=d+"-close",g=i.cloneNode(a);g.id=d,o.appendChild(g),((S(d)||m(d)).querySelector("#"+s)||m(s)).id=h;let u=y({id:[d,h],timeout:e.timeout,onClose:()=>{u&&(u.destroy(),u=r)}})||p("Cannot create toast[modal]: "+d);return u&&(l.push(u),u.open(t)),u},close:e=>{const t=l.indexOf(e);if(t>=0){const e=l[t];e&&e.close()}}}},drawer:(e={id:[]})=>{const t=e.id[0],o=S(t)||m(t),r=S(e.id[1])||m(e.id[1]),s=S(e.id[2]),i="_slideout",l=()=>{h||(h=a,Y.push(d),I(o),w((()=>{K(o),z(r,i,"_slidein"),se(r),w(P,300,r,"_lift-1")})))},d=()=>{h&&(h=c,z(r,"_slidein|_lift-1",i),w(J,300,W(o)),Y.cancel(d),se(n.body))};let h=c;return P(r,i),J(W(o)),X(o,"click",(e=>{e&&e.target===o&&d()})),s&&X(s,"click",d),{open:l,close:d,toggle:()=>{h?d():l()}}},bog:(e="_bog",t=2)=>{const o=S(e)||m(e),n=()=>{o.innerHTML=""},s=(e,s)=>(s&&n(),o.innerHTML+=v(e,r,t)+"\n");return s.clear=n,s}},ae)})),N({version:t,objectOf:d,isArray:f,cantFind:m,invalidArgs:y,JsonParse:_,JsonStringify:v,random:(e,t)=>e&&t?b()*(t-e)+e:e?b()*e:b(),trimNumber:(e,t=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER)=>e>o?o:e<t?t:e,loop:(e,t=0)=>{if(l(e)!==h)return y("for loop","Function");let o,n=c;const r=()=>{n&&(e(s),o=w(r,t))},s={start:()=>{n=a,r()},stop:()=>{k(o),n=c}};return s},each:N,find:(e,t)=>{let o;for(let n=0;!o&&n<e.length;n++)o=t(e[n],n);return o},list:(e,t)=>{const o=[];return e(o)&&t(),{check:n=>{o[n]=a;const r=e(o);return r&&t(),r}}},delay:e=>new Promise((t=>{w(t,e)})),eager:(e,t=100)=>{let o,n=c;const s=()=>{n=c};return(...i)=>(n||(n=a,e.apply(r,i)),k(o),o=w(s,t))},later:C,nodeId:S,nodeTag:$,getNode:(e,t=i)=>t.querySelector(e||""),show:I,hide:J,appendNode:A,prependNode:T,afterNode:(e,t)=>(E(e)||F()).insertBefore(t,e.nextSibling),beforeNode:(e,t)=>(E(e)||F()).insertBefore(t,e),removeNode:B,newNode:O,fa:(e="",t="fas",o="")=>(o&&(o=" "+o),O("i",{class:`_ico -fa${o}`},O("i",{class:`${t} fa-${e}`}))),nodeStyle:H,MatchClass:L,changeClass:z,addClass:P,removeClass:j,fadeIn:K,fadeOut:W,peek:q,listenTo:X,stopListenTo:Q,keypress:V,esc:Y,img:(e,t,o)=>(o&&(X(e,"load",o,{once:a}),X(e,"error",o,{once:a})),e.src=t,e),local:ee,session:te,Data:oe,worker:re,back:(e=-1)=>()=>{o.history.go(e)},goto:(e=".")=>()=>{o.location.href=e},exit:(e="/")=>{const t=o.location,r=n.referrer,s="."+btoa(t.pathname),i=r.match(t.origin);let a=te.getString(s);return a||(a=i&&0==i.index&&r!=t.origin+t.pathname?r:e),te.setString(s,a),()=>{const o=te.getString(s)||e;te.remove(s),t.href=o}},refocus:se,theme:ie,loadNumber:ee.getNumber,saveNumber:e=>t=>ee.setNumber(e,t),loadJson:ee.getJson,saveJson:e=>t=>ee.setJson(e,t),loadString:ee.getString,saveString:e=>t=>ee.setString(e,t)},ae),console.log(`%c Base v${t} `,"background:#259;color:#eee;padding:5px;margin:10px"),e})(window.base)})();